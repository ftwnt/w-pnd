<% if @game_collection.present? %>
  <div id="game-container">
    <h3>Timer:</h3>
    <p id='current-timer-val'></p>

    <div class="img-container">
      <img src='#' id='current-img'/>
    </div>

    <%= button_tag 'Play', id: 'play-btn' %>
  </div>

  <% if @images.present? %>
    <h3>Already played</h3>

    <%= render 'plays/partials/plays_table', plays: @plays %>
  <% end %>

  <script>
    let container = document.querySelector('#game-container')

    const gameHandler = () => {
      if (gon.gameCollection.length === 0) { return }

      const resetTimer = () => {
        return [10, 0]
      }

      const setGameValues = (timer, src) => {
        document.getElementById('current-timer-val').innerHTML = timer
        let img = document.getElementById('current-img')
        img.src = src
        img.style.display = 'block'
      }

      const getImageUrl = (idx) => {
        return gon.gameCollection[idx].url
      }

      let [timer, idx] = resetTimer()
      let imgSrc = getImageUrl(idx)
      setGameValues(timer, imgSrc)

      setInterval(() => {
        if (timer === 1) {
          [timer, idx] = resetTimer()
        } else {
          timer--
          idx++
        }

        imgSrc = getImageUrl(idx)
        setGameValues(timer, imgSrc)
      }, 1000)
    }

    container.addEventListener('load', gameHandler());
  </script>
<% else %>
  <h3>Upload images to start a game :)</h3>
<% end %>


